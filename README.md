# Тестовое задание для направления стажировки: "Backend-стажёр в юнит Авито.Недвижимость (Go/PHP)"

[Текст задания](https://github.com/avito-tech/verticals/blob/master/trainee/backend-str.md)

## Установка проекта

Для установки необходимо:

- PHP v7.3
- База данных: MySQL 5.7
- Пакетный менеджер Composer

В терминале нужно выполнить команду:

```
composer create-project mlfordev/avito_real_estate
```

В файл `/app/config/local_settings.php` нужно внести настройки базы данных. Если файл не создан, нужно переименовать `app/config/_local_settings.php`

В используемой базе данных нужно создать таблицы из файла `/sql/tables.sql`

`DOCUMENT_ROOT` сервера настраивается на папку `/www`

Например, запуск проекта с использованием встроенного dev-сервера:

```
php -S localhost:8880 -t www/
```

## Возникшие вопросы и принятые по ним решения

- Какие коды ответа сервера кроме `200` возвращать в разных ситуациях?
    
    - в случае успешного создания записи в БД - сервер отдаёт код `201` и ID созданной записи;
    - в случае неудачного создании записи, если переданы невалидные данные - код ответа `422` и список ошибок в теле ответа;
    - в случае неудачного создании записи, если неизвестна причина - код ответа `500` и информация об ошибке в теле ответа;
    - в случае удаления записи из БД - код ответа `204` и пустое тело ответа. При повторном запросе на удаление той же записи,
      ошибка не возникает, и ответ повторяется: `204` и пустое тело;
   

## Описание методов API

http-метод | URI | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Параметры запроса &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | Пример запроса | Результат
---------- | --- | ----------------- | --------- | --------------
`GET` | `/rooms` | без параметров или параметр сортировки `order`, <br>может принимать значения: <br>`price` -  по цене по возрастанию, <br>`-price` - по цене по убыванию, <br>`created_at` - по дате добавления по возрастанию, <br>`-created_at` - по дате добавления по убыванию | запрос без сортировки `curl -X GET http://localhost:8880/rooms` <br><br> запрос с сортировкой по цене по возрастанию `curl -X GET -d "order=price" -G http://localhost:8880/rooms` <br><br> запрос с сортировкой по цене по убыванию `curl -X GET -d "order=-price" -G http://localhost:8880/rooms` <br><br> Отличие в знаке `-` перед значением параметра `order` | Получает список номеров отеля. <br><br>Возвращает список номеров отеля (сортированный список номеров отеля) в виде массива объектов в формате JSON. <br><br>Код ответа - `200`<br><br>Если массив получился пустой, всё равно возвращается `200` с пустым массивом `[]` в теле ответа.<br><br> Пример тела ответа:<br><br>`[{"id":"3","description":"описание 1","price":"1000","created_at":"2021-01-07 15:26:34"},{"id":"5","description":"описание ...","price":"2020","created_at":"2021-01-08 16:49:16"},{"id":"11","description":"описание ...","price":"2022","created_at":"2021-01-09 15:50:11"}]`
`POST` | `/rooms` | `price` - цена за ночь. Параметр должен быть целым числом или числом с плавающей точкой. Параметр обязателен для передачи<br><br>`description` - текстовое описание номера. Параметр обязателен для передачи | `curl -X POST  -d "price=2000" -d "description=описание номера" http://localhost:8880/rooms` | Добавляет номер отеля. <br><br>Создаёт в базе данных запись о номере отеля. Возвращает ID номера отеля в виде объекта в формате JSON.<br><br>Код ответа в случае успеха - `201`<br><br>Пример тела ответа:<br><br>`{"room_id":"18"}`<br><br>Если запись о номере не была создана, описание ошибки приводится в теле ответа.<br><br>Код ответа - `422`, `500`
`DELETE` | `/rooms/{:id}` | `{:id}` - параметр в составе иерархической части URI. ID номера отеля. Должен быть положительным целым числом | `curl -X DELETE  http://localhost:8880/rooms/8` | Удаляет номер отеля и все его брони.<br><br>Код ответа - `204`<br><br>Тело ответа - пустое
`GET` | `/rooms/{:roomId}/bookings` | `{:roomId}` - параметр в составе иерархической части URI. ID номера отеля. Должен быть положительным целым числом | `curl -X GET http://localhost:8880/rooms/11/bookings` | Получает список броней номера отеля.<br><br>Возвращает список бронирований в виде массива объектов в формате JSON, каждое бронирование содержит ID, дату начала, дату окончания. Бронирования отсортированы по дате начала.<br><br>Код ответа - `200`<br><br>Если массив получился пустой, всё равно возвращается `200` с пустым массивом `[]` в теле ответа.<br><br>Пример тела ответа:<br><br>`[{"id":"10","date_start":"2021-09-05","date_end":"2021-09-12"},{"id":"11","date_start":"2021-09-06","date_end":"2021-09-12"},{"id":"8","date_start":"2021-09-07","date_end":"2021-09-12"}]`
`POST` | `/rooms/{:roomId}/bookings` | `{:roomId}` - параметр в составе иерархической части URI. ID номера отеля. Должен быть положительным целым числом<br><br>`date_start` - дата начала брони. Должна быть в формате "год-месяц-день", например: "2020-01-30". Должна быть валидной датой. Параметр обязателен для передачи<br><br>`date_end` - дата окончания брони. Должна быть в формате "год-месяц-день", например: "2020-01-30". Должна быть валидной датой. Параметр обязателен для передачи | `curl -X POST  -d "date_start=2021-10-30" -d "date_end=2021-11-21" http://localhost:8880/rooms/11/bookings` | Добавляет бронь.<br><br>Создаёт в базе данных запись о бронировании номера отеля. Возвращает ID брони в виде объекта в формате JSON.<br><br>Код ответа в случае успеха - `201`<br><br>Пример тела ответа:<br><br>`{"booking_id":"14"}`<br><br>Если запись о бронировании номера не была создана, описание ошибки приводится в теле ответа.<br><br>Код ответа - `422`, `500`
`DELETE` | `/bookings/{:id}` | `{:id}` - параметр в составе иерархической части URI. ID брони. Должен быть положительным целым числом | `curl -X DELETE http://localhost:8880/bookings/12` | Удаляет бронь.<br><br>Код ответа - `204`<br><br>Тело ответа - пустое

